---
title: 文本和字节序列
date: 2022-03-05 18:03:12
tags:
---


> 人类使用文本，计算机使用字节序列。 
> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; ———— Esther Nam 和 Travis Fischer “Character Encoding and Unicode in Python”

英文字母、中文汉字，或是其他国家的语言文字，我们可以在计算机上看到这些可读文本，但计算机并不直接使用它们。

在计算机中，字节序列（二进制数据）可以以某种映射关系转化为规定好的文本字符串（不考虑这些数据是不是文本数据）。这种映射关系就是编码（字符编码，名词），这个转化过程就叫做解码，相反，把文本字符串转化为字节序列的过程叫做编码（动词）。

假设有一个文件，其中存储了 utf-8 编码的一段文字，当使用某个软件打开它时需要指定一个编码，如果这个编码与这本文件的编码不一致，看到的很可能就是一串乱码。这是因为解读这段文字的字节序列使用的编码与写这段文字的编码不同。

所以编码其实就像是一个双向映射表，一个协议，约定了人类需要使用的文本字符在计算机中使用哪些字节序列表示。比如字符拉丁大写字母 “A” 可以对应码位十六进制数字 65，ASCII 中使用一个字节的字节序列 `0100 0001` 表示。

## ASCII 和其他编码

最早的编码是 ASCII 编码（/ˈæski/，American Standard Code for Information Interchange），一共 128 个字符包括大小写英文字母、数字和一些符号。由于编码字符足够少，一个字符只需要一个字节表示（一个字节的范围是 0~255 ，最多可以表示 256 个字符）。

显然其他语言使用者要在计算机上显示自己的语言文字就需要一套自己的编码。于是有了汉语的 GB2312 、GBK 和 GB18030 ，日文的 Shift_JIS 等。而且根据语言中要表示的文字的数量的多少所需要的字节数也不同（另外还有一种可变长编码）。

当各个国家的人要相互交流的时候都是用各自的编码就会特别麻烦，一不小心就会出现乱码，于是就需要一个统一的编码。

## Unicode 和 utf-8

Unicode 标准包含了世界上大部分语言，这样所有人统一使用它就不用总是区分编码，也不会有乱码问题了。

值得一提的是 Unicode 实际是一个标准，不是一个具体的编码。它给世上大部分语言的文字字符分配了一个唯一数字（码位，code point）。而这个数字如何用字节序列表示就是编码的问题。

也就是说标准定义了从一组字符到一组数字，编码定义了一组字符到一组字节序列。

最常用的 utf-8 就是遵循 Unicode 标准的编码。utf-8 用一个字节表示 Unicode 定义的前 128 个码位，这 128个 码位与 ASCII 相同，意味着一个 ASCII 编码的文本与 Unicode 编码的文本在字节序列上相同。用两个字节表示阿拉伯语、希伯来语和大部分欧洲语言。用三个字节表示 Unicode 定义的 BMP(Basic Multilingual Plane)（中文、日文、韩文等）。用四个字节表示所有的 Unicode 字符。

另外 utf-16 、甚至 utf-32 也是它的实现。（8 、16 和 32 是指最少使用多少位表示码位）utf-16 用两个字节表示 BMP。4 个字节表示所有字符。

## Python 中的 Unicode

Unicode 在 Python 中是区别于具体编码的单独的类型。因为 Unicode 是一个标准（一个字符对应一个码位），Python 中一个 Unicode 字符代表一个数字。比如中文中国表示为 `u'\u4e2d\u56fd'` ，其中 `4e2d` 就是中这个字符在 Unicode 中十六进制形式的码位。

如果是 utf-8 编码在 Python 中就表示为 `\xe4\xb8\xad\xe5\x9b\xbd` ，一共 6 个字节，一个汉字三个字节。

utf-16编码中表示为 `\xff\xfe-N\xfdV` ，其中\xff\xfe表示字节序标记（BOM，Byte Order Mark），代表小字节序。其后共四个字节。
